image: buildstream/buildstream-fedora:master-47-e8de57f

variables:
  GET_SOURCES_ATTEMPTS: 3
  BST: 'bst --colors'
  BST_SHA: 'a10ef1a4db25b408841c4b20cec64315cb085b59'

stages:
  - build

before_script:
  - git clone https://gitlab.com/BuildStream/buildstream.git
  # Use specific version of BuildStream
  - git -C buildstream/ checkout $BST_SHA
  - pip3 install buildstream

# Store all the downloaded git and ostree repos in the distributed cache.
# This saves us fetching them from git.baserock.org and further afield
# on every build.
.bst_cache: &bst_cache
  cache:
    key: bst
    paths:
      - "${XDG_CACHE_HOME}/buildstream/sources/"



bst-build-gnome-core:
  stage: build
  dependencies: []
  script:
    - ${BST} build core/meta-gnome-core.bst
  <<: *bst_cache
