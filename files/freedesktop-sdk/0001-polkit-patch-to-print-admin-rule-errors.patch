From e41277bdcf45514fc87cd879919190b93d55292e Mon Sep 17 00:00:00 2001
From: Jordan Petridis <jordan@centricular.com>
Date: Tue, 19 Jul 2022 17:07:49 +0300
Subject: [PATCH] polkit: patch to print admin rule errors

---
 elements/components/polkit.bst                |  2 ++
 ...tapeauthority.c-Print-the-error-stri.patch | 27 +++++++++++++++++++
 2 files changed, 29 insertions(+)
 create mode 100644 files/polkit/0001-polkitbackendduktapeauthority.c-Print-the-error-stri.patch

diff --git a/elements/components/polkit.bst b/elements/components/polkit.bst
index 79ee6490f..d350d15de 100644
--- a/elements/components/polkit.bst
+++ b/elements/components/polkit.bst
@@ -49,3 +49,5 @@ sources:
 - kind: local
   path: files/polkit/sysusers.conf
   directory: extra
+- kind: patch
+  path: files/polkit/0001-polkitbackendduktapeauthority.c-Print-the-error-stri.patch
diff --git a/files/polkit/0001-polkitbackendduktapeauthority.c-Print-the-error-stri.patch b/files/polkit/0001-polkitbackendduktapeauthority.c-Print-the-error-stri.patch
new file mode 100644
index 000000000..55081de63
--- /dev/null
+++ b/files/polkit/0001-polkitbackendduktapeauthority.c-Print-the-error-stri.patch
@@ -0,0 +1,27 @@
+From c9348d91a6f0cfa8eb820486f2620165cf9a1402 Mon Sep 17 00:00:00 2001
+From: Jordan Petridis <jordan@centricular.com>
+Date: Tue, 19 Jul 2022 16:58:09 +0300
+Subject: [PATCH] polkitbackendduktapeauthority.c: Print the error string we
+ get back from duktape
+
+Looks like it was a typo.
+---
+ src/polkitbackend/polkitbackendduktapeauthority.c | 2 +-
+ 1 file changed, 1 insertion(+), 1 deletion(-)
+
+diff --git a/src/polkitbackend/polkitbackendduktapeauthority.c b/src/polkitbackend/polkitbackendduktapeauthority.c
+index f4b4304..02dbcfe 100644
+--- a/src/polkitbackend/polkitbackendduktapeauthority.c
++++ b/src/polkitbackend/polkitbackendduktapeauthority.c
+@@ -590,7 +590,7 @@ runaway_killer_thread_call_js (gpointer user_data)
+   if (duk_pcall_prop (cx, 0, 2) != DUK_EXEC_SUCCESS)
+     {
+       polkit_backend_authority_log (POLKIT_BACKEND_AUTHORITY (ctx->authority),
+-                                    "Error evaluating admin rules: ",
++                                    "Error evaluating admin rules: %s",
+                                     duk_safe_to_string (cx, -1));
+       goto err;
+     }
+-- 
+2.36.1
+
-- 
2.36.1

