commit 6657814f7746bdb06a9c48c2bd3b92bebb940a8a
Author: Abderrahim Kitouni <a.kitouni@gmail.com>
Date:   Fri May 18 19:27:53 2018 +0100

    allow disabling valadoc

diff --git a/configure.ac b/configure.ac
index fcfdd40d5..b2bfdf5bc 100644
--- a/configure.ac
+++ b/configure.ac
@@ -112,6 +112,10 @@ PKG_CHECK_MODULES(GMODULE, gmodule-2.0 >= $GLIB_REQUIRED)
 AC_SUBST(GMODULE_CFLAGS)
 AC_SUBST(GMODULE_LIBS)
 
+AC_ARG_ENABLE(valadoc, AS_HELP_STRING([--disable-valadoc], [Disable building valadoc]), enable_valadoc=$enableval, enable_valadoc=yes)
+AM_CONDITIONAL(ENABLE_VALADOC, test x$enable_valadoc = xyes)
+
+if test x$enable_valadoc = xyes; then
 PKG_CHECK_MODULES(LIBGVC, libgvc >= $LIBGVC_REQUIRED)
 AC_MSG_CHECKING([for CGRAPH])
 cgraph_tmp_LIBADD="$LIBADD"
@@ -140,6 +144,8 @@ AC_RUN_IFELSE(
 )
 LIBADD="$cgraph_tmp_LIBADD"
 CFLAGS="$cgraph_tmp_CFLAGS"
+fi
+
 AM_CONDITIONAL(HAVE_CGRAPH, test "$have_cgraph" = "yes")
 
 AC_PATH_PROG([XSLTPROC], [xsltproc], :)
diff --git a/libvaladoc/Makefile.am b/libvaladoc/Makefile.am
index 384292f57..b9a6fa30f 100644
--- a/libvaladoc/Makefile.am
+++ b/libvaladoc/Makefile.am
@@ -2,6 +2,8 @@ include $(top_srcdir)/Makefile.common
 
 NULL =
 
+if ENABLE_VALADOC
+
 AM_CFLAGS = \
 	-DPACKAGE_ICONDIR=\"$(datadir)/valadoc/icons/\" \
 	-DPACKAGE_DATADIR=\"$(libdir)/valadoc\" \
@@ -239,3 +241,4 @@ MAINTAINERCLEANFILES = \
 	$(libvaladoc_la_VALASOURCES:.vala=.c) \
 	$(NULL)
 
+endif
diff --git a/valadoc/Makefile.am b/valadoc/Makefile.am
index 33f3a9375..d6ffb3fd4 100644
--- a/valadoc/Makefile.am
+++ b/valadoc/Makefile.am
@@ -2,6 +2,7 @@ include $(top_srcdir)/Makefile.common
 
 NULL =
 
+if ENABLE_VALADOC
 SUBDIRS = \
 	doclets \
 	icons \
@@ -80,3 +81,5 @@ endif
 MAINTAINERCLEANFILES = \
 	$(valadoc_VALASOURCES:.vala=.c) \
 	$(NULL)
+
+endif
