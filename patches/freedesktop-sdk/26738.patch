From 21a470d175eade0fcdfba51df1cbf0bdab086cd7 Mon Sep 17 00:00:00 2001
From: Valentin David <me@valentindavid.com>
Date: Mon, 7 Apr 2025 20:41:08 +0200
Subject: [PATCH 1/5] linux: Enable DRM_XE and PINCTRL_INTEL_PLATFORM

These are needed for no Intel processors.
---
 files/linux/fdsdk-config.sh | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/files/linux/fdsdk-config.sh b/files/linux/fdsdk-config.sh
index a44beeb8de3..e1129ff15db 100644
--- a/files/linux/fdsdk-config.sh
+++ b/files/linux/fdsdk-config.sh
@@ -621,6 +621,7 @@ case "$arch" in
     x86_64|i686)
         remove DRM_I915; module DRM_I915
         module DRM_GMA500
+        module DRM_XE
     ;;
     aarch64)
         module DRM_PANFROST
@@ -1168,6 +1169,7 @@ case "$arch" in
         enable IRQ_REMAP
         enable X86_AMD_PLATFORM_DEVICE
         enable CONFIG_X86_USER_SHADOW_STACK
+        enable PINCTRL_INTEL_PLATFORM
     ;;
 esac
 
-- 
GitLab


From 5a60dd12ce584364b4e00fbacbcee54834f525db Mon Sep 17 00:00:00 2001
From: Abderrahim Kitouni <akitouni@gnome.org>
Date: Fri, 30 May 2025 21:27:17 +0100
Subject: [PATCH 2/5] components/grpc.bst: build shared libraries

---
 elements/components/grpc.bst | 1 +
 1 file changed, 1 insertion(+)

diff --git a/elements/components/grpc.bst b/elements/components/grpc.bst
index 8038bae8d50..f6bf067c5c6 100644
--- a/elements/components/grpc.bst
+++ b/elements/components/grpc.bst
@@ -11,6 +11,7 @@ depends:
 
 variables:
   cmake-local: >-
+    -DBUILD_SHARED_LIBS=ON
     -DgRPC_SSL_PROVIDER=package
     -DgRPC_PROTOBUF_PROVIDER=package
     -DgRPC_ZLIB_PROVIDER=package
-- 
GitLab


From 7321661f9d45930413d3dee4afd7ce24f32deae4 Mon Sep 17 00:00:00 2001
From: Valentin David <me@valentindavid.com>
Date: Mon, 7 Apr 2025 20:31:40 +0200
Subject: [PATCH 3/5] files/vm/prepare-image.sh: Allow no root in fstab

Because gpt-auto on systemd generates the mount for /, we do not need
it in fstab. So we need a way to not add it to fstab.
---
 files/vm/prepare-image.sh | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/files/vm/prepare-image.sh b/files/vm/prepare-image.sh
index 98506a15b83..52026526e94 100755
--- a/files/vm/prepare-image.sh
+++ b/files/vm/prepare-image.sh
@@ -12,6 +12,7 @@ uuidnamespace="$(uuidgen -r)"
 rootfstype="ext4"
 rootfsopts="errors=remount-ro,relatime"
 root_source=
+noroot=
 
 while [ $# -gt 0 ]; do
     param="$1"
@@ -64,6 +65,10 @@ while [ $# -gt 0 ]; do
             rootfsopts="$1"
             shift
             ;;
+        --noroot)
+            noroot="1"
+            shift
+            ;;
     esac
 done
 
@@ -125,9 +130,11 @@ if [ -z "${root_source}" ]; then
     root_source="UUID=${uuid_root}"
 fi
 
-cat >"${sysroot}/etc/fstab" <<EOF
+if [ -z "${noroot}" ]; then
+  cat >>"${sysroot}/etc/fstab" <<EOF
 ${root_source} / ${rootfstype} ${rootfsopts} 0 1
 EOF
+fi
 
 if [ -z "${noboot}" ]; then
     cat >>"${sysroot}/etc/fstab" <<EOF
-- 
GitLab


From 646d1518f1141aaa70f2d24e0cb7efdd01b28846 Mon Sep 17 00:00:00 2001
From: Valentin David <me@valentindavid.com>
Date: Sun, 13 Apr 2025 16:14:26 +0200
Subject: [PATCH 4/5] prepare-image.sh: Make --noroot not expect a value

---
 files/vm/prepare-image.sh | 1 -
 1 file changed, 1 deletion(-)

diff --git a/files/vm/prepare-image.sh b/files/vm/prepare-image.sh
index 52026526e94..069ec6d385c 100755
--- a/files/vm/prepare-image.sh
+++ b/files/vm/prepare-image.sh
@@ -67,7 +67,6 @@ while [ $# -gt 0 ]; do
             ;;
         --noroot)
             noroot="1"
-            shift
             ;;
     esac
 done
-- 
GitLab


From 9a1774a6726861112b2f3637e82abee1eb10d6d9 Mon Sep 17 00:00:00 2001
From: Valentin David <me@valentindavid.com>
Date: Mon, 17 Mar 2025 17:33:42 +0100
Subject: [PATCH 5/5] split-rules: Move zoneinfo out of locales

Zoneinfo files are not locales. Also they take very little space.
---
 elements/flatpak-images/platform.bst |  1 +
 elements/flatpak-images/sdk.bst      |  1 +
 include/_private/split-rules.yml     | 13 +++++++++++++
 3 files changed, 15 insertions(+)

diff --git a/elements/flatpak-images/platform.bst b/elements/flatpak-images/platform.bst
index 832076484c6..d4524879d8b 100644
--- a/elements/flatpak-images/platform.bst
+++ b/elements/flatpak-images/platform.bst
@@ -11,6 +11,7 @@ config:
   - locale
   - tests
   - shells
+  - zoneinfo
 
   metadata:
     Runtime:
diff --git a/elements/flatpak-images/sdk.bst b/elements/flatpak-images/sdk.bst
index 1c8a65f0336..fb3e606b388 100644
--- a/elements/flatpak-images/sdk.bst
+++ b/elements/flatpak-images/sdk.bst
@@ -11,6 +11,7 @@ config:
   - locale
   - tests
   - shells
+  - zoneinfo
 
   metadata:
     Runtime:
diff --git a/include/_private/split-rules.yml b/include/_private/split-rules.yml
index 205055405dd..1c4c05df044 100644
--- a/include/_private/split-rules.yml
+++ b/include/_private/split-rules.yml
@@ -59,3 +59,16 @@ shells:
   - "%{datadir}/zsh/**"
 
 static-blocklist: []
+
+locale:
+  - "%{datadir}/locale"
+  - "%{datadir}/locale/**"
+  - "%{datadir}/i18n"
+  - "%{datadir}/i18n/**"
+
+zoneinfo:
+  - "%{datadir}/zoneinfo"
+  - "%{datadir}/zoneinfo/**"
+  - "%{datadir}/zoneinfo-leaps"
+  - "%{datadir}/zoneinfo-leaps/**"
+  - "%{datadir}/zoneinfo-posix"
-- 
GitLab

